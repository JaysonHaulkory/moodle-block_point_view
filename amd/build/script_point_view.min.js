define(["jquery","core/ajax","core/notification"],function(B,C,R){return{init:function(a){B(function(){B(".mod-indent-outer").css({width:"85%"}),B(".coursebox").append("<div class='reaction_box'></div>"),B(".coursebox").css({height:"48px"}),B("#frontpage-available-course-list .reaction_box").css({position:"relative",left:"72%",top:"-30px",width:"10%"}),B(".coursebox").append("<div class='difficulty_box'></div>"),B("#frontpage-available-course-list .difficulty_box").css({position:"relative",top:"-37px",width:"10px"}),B(".coursebox a").css({position:"relative",left:"10px"}),B(".folder .mod-indent-outer").prepend('<div class="activityinstance" style="width: 0px;"><a></a></div>');var E=parseInt(a.userid),T=a.courseid,e=a.contextid,t=C.call([{methodname:"block_point_view_get_database",args:{userid:E,courseid:T},fail:R.exception},{methodname:"block_point_view_get_pixparam",args:{courseid:T,contextid:e},fail:R.exception},{methodname:"block_point_view_get_moduleselect",args:{courseid:T},fail:R.exception},{methodname:"block_point_view_get_difficulty_levels",args:{courseid:T},fail:R.exception},{methodname:"block_point_view_get_track_colors",args:{},fail:R.exception},{methodname:"block_point_view_get_enrol_list",args:{userid:E},fail:R.exception}]);B.when(t[0],t[1],t[2],t[3],t[4],t[5]).done(function(e,t,a,o,d,l){var c=e,m=t,n=o,s=d,i=l,r=a,u={NULL:0,EASY:1,BETTER:2,HARD:3},p={},b={},f={},h={},g={};function _(e,t){var a="group_";if(parseInt(e.getElementsByClassName("easy_nb")[0].innerText)&&(a+="E"),parseInt(e.getElementsByClassName("better_nb")[0].innerText)&&(a+="B"),parseInt(e.getElementsByClassName("hard_nb")[0].innerText)&&(a+="H"),b[t]!==u.NULL){var o=B("#module-"+t+" .group_nb");o.addClass("voted"),10<=f[t]&&o.css({"font-size":"10px"})}else B("#module-"+t+" .group_nb").removeClass("voted");B("#module-"+t+" .group_img").attr("src",m[a])}function I(e){B(this).stop(),B(this).css({cursor:"pointer"}),B(this).animate({top:-1.5,left:-3,height:23},100),g[e.data.moduleId]=setTimeout(function(){0===parseInt(e.data.module.getElementsByClassName("easy_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" .easy").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(e.data.module.getElementsByClassName("better_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" .better").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),0===parseInt(e.data.module.getElementsByClassName("hard_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" .hard").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),B("#module-"+e.data.moduleId+" .group_img").animate({top:"+=15",left:"+=35",height:0},300).hide(0),B("#module-"+e.data.moduleId+" .group_nb").delay(50).hide(300),B("#module-"+e.data.moduleId+" .actions").hide(300),B("#module-"+e.data.moduleId+" .easy").delay(50).animate({top:-15,left:-20,height:20},300).css({"pointer-events":"auto"}),B("#module-"+e.data.moduleId+" .easy_nb").delay(50).show(300),B("#module-"+e.data.moduleId+" .better").delay(200).animate({top:-15,left:25,height:20},300).css({"pointer-events":"auto"}),B("#module-"+e.data.moduleId+" .better_nb").delay(200).show(300),B("#module-"+e.data.moduleId+" .hard").delay(400).animate({top:-15,left:70,height:20},300).css({"pointer-events":"auto"}),B("#module-"+e.data.moduleId+" .hard_nb").delay(400).show(300)},500),clearTimeout(h[e.data.moduleId]),h[e.data.moduleId]=setTimeout(function(){p[e.data.moduleId]||(B("#module-"+e.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),B("#module-"+e.data.moduleId+" .hard_nb").delay(50).hide(300),B("#module-"+e.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),B("#module-"+e.data.moduleId+" .better_nb").delay(300).hide(300),B("#module-"+e.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),B("#module-"+e.data.moduleId+" .easy_nb").delay(600).hide(300),_(e.data.module,e.data.moduleId),B("#module-"+e.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(e.data.module.getElementsByClassName("group_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" .group_nb").delay(600).show(300),B("#module-"+e.data.moduleId+" .actions").delay(600).show(300))},2e3)}function y(e){B(this).stop(),clearTimeout(g[e.data.moduleId]),"0px"===B("#module-"+e.data.moduleId+" .easy").css("height")&&B(this).animate({top:0,left:0,height:20},100)}function v(e){B(this).stop();var t=B("#module-"+e.data.moduleId+" ."+e.data.reactionName+"_txt").width();B("#module-"+e.data.moduleId+" ."+e.data.reactionName+"_txt").css({left:e.data.leftReaction+10-t/2+70}),0===parseInt(e.data.module.getElementsByClassName(e.data.reactionName+"_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" ."+e.data.reactionName).css({"-webkit-filter":"",filter:""}),B(this).css({cursor:"pointer"}),B(this).animate({top:-25,left:e.data.leftReaction,height:40},100)}function x(e){B(this).stop(),B(this).animate({top:-15,left:e.data.leftReaction,height:20},100),0===parseInt(e.data.module.getElementsByClassName(e.data.reactionName+"_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" ."+e.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}function k(a){if(1!=T||i.ids.includes(a.data.moduleId.toString(10))){if(null!==E&&1!==E){var o=parseInt(a.data.module.getElementsByClassName(a.data.reactionName+"_nb")[0].innerText);f[a.data.moduleId]=parseInt(a.data.module.getElementsByClassName("group_nb")[0].innerText),0===o&&B("#module-"+a.data.moduleId+" ."+a.data.reactionName).css({"-webkit-filter":"",filter:""}),b[a.data.moduleId]===u.NULL?C.call([{methodname:"block_point_view_update_db",args:{func:"insert",userid:E,courseid:T,cmid:a.data.moduleId,vote:a.data.reactionSelect},done:function(){a.data.module.getElementsByClassName(a.data.reactionName+"_nb")[0].innerText=o+1,B("#module-"+a.data.moduleId+" ."+a.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"}),a.data.module.getElementsByClassName("group_nb")[0].innerText=f[a.data.moduleId]+1,b[a.data.moduleId]=a.data.reactionSelect},fail:R.exception}]):b[a.data.moduleId]===a.data.reactionSelect?C.call([{methodname:"block_point_view_update_db",args:{func:"remove",userid:E,courseid:T,cmid:a.data.moduleId,vote:a.data.reactionSelect},done:function(){o--,a.data.module.getElementsByClassName(a.data.reactionName+"_nb")[0].innerText=o,B("#module-"+a.data.moduleId+" ."+a.data.reactionName+"_nb").css({"font-weight":"normal",color:"black"}),0===o&&B("#module-"+a.data.moduleId+" ."+a.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),a.data.module.getElementsByClassName("group_nb")[0].innerText=f[a.data.moduleId]-1,b[a.data.moduleId]=u.NULL},fail:R.exception}]):C.call([{methodname:"block_point_view_update_db",args:{func:"update",userid:E,courseid:T,cmid:a.data.moduleId,vote:a.data.reactionSelect},done:function(){var e;switch(a.data.module.getElementsByClassName(a.data.reactionName+"_nb")[0].innerText=o+1,B("#module-"+a.data.moduleId+" ."+a.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"}),b[a.data.moduleId]){case u.EASY:e="easy";break;case u.BETTER:e="better";break;case u.HARD:e="hard"}var t=parseInt(a.data.module.getElementsByClassName(e+"_nb")[0].innerText)-1;a.data.module.getElementsByClassName(e+"_nb")[0].innerText=t,B("#module-"+a.data.moduleId+" ."+e+"_nb").css({"font-weight":"normal",color:"black"}),0==t&&B("#module-"+a.data.moduleId+" ."+e).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"}),b[a.data.moduleId]=a.data.reactionSelect},fail:R.exception}])}}else alert("You are not enrolled in this course, you can't react to this.")}function w(e){p[e.data.moduleId]=!0}function N(e){p[e.data.moduleId]=!1,clearTimeout(h[e.data.moduleId]),h[e.data.moduleId]=setTimeout(function(){p[e.data.moduleId]||(B("#module-"+e.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500),B("#module-"+e.data.moduleId+" .hard_nb").delay(50).hide(300),B("#module-"+e.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500),B("#module-"+e.data.moduleId+" .better_nb").delay(300).hide(300),B("#module-"+e.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500),B("#module-"+e.data.moduleId+" .easy_nb").delay(600).hide(300),_(e.data.module,e.data.moduleId),B("#module-"+e.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300),0!==parseInt(e.data.module.getElementsByClassName("group_nb")[0].innerText)&&B("#module-"+e.data.moduleId+" .group_nb").delay(600).show(300),B("#module-"+e.data.moduleId+" .actions").delay(600).show(300))},1e3)}r.forEach(function(e){var t=parseInt(e);p[t]=!1,b[t]=null,f[t]=null,h[t]=null,g[t]=null}),B(".activity").not(".label").mouseover(function(){B(this).css({background:"linear-gradient(to right, #f4f4f4, #f4f4f4, white)","border-radius":"5px"})}).mouseout(function(){B(this).css({background:""})}),r.forEach(function(e){var t,a,o,d=parseInt(e);if(null!==document.getElementById("module-"+d)||null!==document.querySelectorAll('[data-courseid="'+d+'"]')){var l=(t=d,o=!1,c.forEach(function(e){parseInt(e.cmid)===t&&(a=e,o=!0)}),o||(a={cmid:t.toString(),courseid:T,total:"0",typeone:"0",typetwo:"0",typethree:"0",uservote:"0"}),a);B('.coursebox[data-courseid="'+d+'"]').prop("id","module-"+d);var n='<div class="block_point_view reactions">\x3c!-- EASY ! --\x3e<span class="tooltipreaction"><img src="'+m.easy+'" alt=" " class="easy"/><span class="tooltiptextreaction easy_txt">'+m.easytxt+'</span></span><span class="easy_nb">'+l.typeone+'</span>\x3c!-- I\'M GETTING BETTER --\x3e<span class="tooltipreaction"><img src="'+m.better+'" alt=" " class="better"/><span class="tooltiptextreaction better_txt">'+m.bettertxt+'</span></span><span class="better_nb">'+l.typetwo+'</span>\x3c!-- SO HARD... --\x3e<span class="tooltipreaction"><img src="'+m.hard+'" alt=" " class="hard"/><span class="tooltiptextreaction hard_txt">'+m.hardtxt+'</span></span><span class="hard_nb">'+l.typethree+'</span></div>\x3c!-- GROUP --\x3e<div class="block_point_view group"><img src="" alt=" " class="group_img"/><span class="group_nb">'+l.total+"</span></div>";switch(1!=T?B("#module-"+d+" .activityinstance").append(n):B('.coursebox[data-courseid="'+d+'"] .reaction_box').append(n),parseInt(l.uservote)){case 1:b[d]=u.EASY,B("#module-"+d+" .easy_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 2:b[d]=u.BETTER,B("#module-"+d+" .better_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 3:b[d]=u.HARD,B("#module-"+d+" .hard_nb").css({"font-weight":"bold",color:"#5585B6"});break;default:b[d]=u.NULL}var s=document.getElementById("module-"+d);0===parseInt(s.getElementsByClassName("group_nb")[0].innerText)&&B("#module-"+d+" .group_nb").hide(),_(s,d),B("#module-"+d+" .group_img").mouseover({module:s,moduleId:d},I).click({module:s,moduleId:d},I).mouseout({moduleId:d},y),B("#module-"+d+" .easy").mouseover({module:s,moduleId:d,reactionName:"easy",className:"easy_txt",leftReaction:-30},v).mouseout({module:s,moduleId:d,leftReaction:-20,reactionName:"easy"},x).click({module:s,moduleId:d,reactionName:"easy",reactionSelect:u.EASY},k),B("#module-"+d+" .better").mouseover({module:s,moduleId:d,reactionName:"better",className:"better_txt",leftReaction:15},v).mouseout({module:s,moduleId:d,leftReaction:25,reactionName:"better"},x).click({module:s,moduleId:d,reactionName:"better",reactionSelect:u.BETTER},k);var i=B("#module-"+d+" .hard"),r=parseInt(i.css("left").slice(0,-2),10);i.mouseover({module:s,moduleId:d,reactionName:"hard",className:"hard_txt",leftReaction:r-20},v).mouseout({module:s,moduleId:d,leftReaction:r-10,reactionName:"hard"},x).click({module:s,moduleId:d,reactionName:"hard",reactionSelect:u.HARD},k),B("#module-"+d+" .reactions").mouseover({moduleId:d},w).mouseout({module:s,moduleId:d},N)}}),n.forEach(function(e){var t=1==T?" .difficulty_box":" .activityinstance a";if(B('.coursebox[data-courseid="'+e.id+'"]').prop("id","module-"+e.id),"0"!==e.difficultyLevel){var a;switch(parseInt(e.difficultyLevel)){case 1:a="green";break;case 2:a="blue";break;case 3:a="red";break;case 4:a="black"}var o='<div class="block_point_view track '+a+'track"></div>';B("#module-"+e.id+t).prepend(o)}else{B("#module-"+e.id+t).prepend('<span class="block_point_view track"></span>')}}),B("#region-main > .card").css({"overflow-x":"unset"}),B(".greentrack").css({"background-color":s.greentrack}),B(".bluetrack").css({"background-color":s.bluetrack}),B(".redtrack").css({"background-color":s.redtrack}),B(".blacktrack").css({"background-color":s.blacktrack}),B(".block_point_view #menu_point_view_img").mouseover(function(){B(this).css({"-webkit-filter":"invert(100%)","-moz-filter":"invert(100%)","-o-filter":"invert(100%)","-ms-filter":"invert(100%)"})}).mouseout(function(){B(this).css({"-webkit-filter":"invert(0%)","-moz-filter":"invert(0%)","-o-filter":"invert(0%)","-ms-filter":"invert(0%)"})})})})}}});